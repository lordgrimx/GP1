<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: backend/models/testTrackModel.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: backend/models/testTrackModel.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import mongoose from 'mongoose';

/**
 * @desc    Deneme sınavı takip şeması
 * @details Kullanıcıların deneme sınavı sonuçlarının veritabanı modeli
 * 
 * @property {ObjectId} user - Sınavı çözen kullanıcının ID'si
 * @property {String} examName - Deneme sınavının adı
 * @property {String} examType - Sınav türü (TYT/AYT)
 * @property {String} aytField - AYT alan türü (Sayısal/Sözel/Eşit Ağırlık/Yabancı Dil)
 * @property {ObjectId} linkedExamId - Bağlantılı sınav ID'si (TYT-AYT eşleşmesi için)
 * @property {Map} subjects - Her ders için doğru/yanlış/boş/net bilgileri
 * @property {Number} totalNet - Toplam net sayısı
 * @property {Number} examScore - Ham puan
 * @property {Number} finalScore - Yerleştirme puanı
 * 
 * @hook pre-save - Net ve puan hesaplamalarını otomatik yapar
 */
const testTrackSchema = new mongoose.Schema({
  user: {
    type: mongoose.Schema.Types.ObjectId,
    required: true,
    ref: 'User'
  },
  examName: {
    type: String,
    required: true
  },
  examType: {
    type: String,
    required: true,
    enum: ['TYT', 'AYT']
  },
  aytField: {
    type: String,
    enum: ['Sayısal', 'Sözel', 'Eşit Ağırlık', 'Yabancı Dil'],
    required: function() {
      return this.examType === 'AYT';
    }
  },
  linkedExamId: {
    type: mongoose.Schema.Types.ObjectId,
    ref: 'TestTrack'
  },
  subjects: {
    type: Map,
    of: {
      correct: Number,
      incorrect: Number,
      empty: Number,
      net: Number
    }
  },
  totalNet: Number,
  examScore: Number,
  finalScore: Number
}, {
  timestamps: true
});

// Net ve puan hesaplama middleware'i
testTrackSchema.pre('save', function(next) {
  // Her ders için net hesapla
  let totalNet = 0;
  this.subjects.forEach((value, key) => {
    const net = value.correct - (value.incorrect / 4);
    value.net = parseFloat(net.toFixed(2));
    totalNet += net;
  });
  
  this.totalNet = parseFloat(totalNet.toFixed(2));
  
  // Ham puan hesapla
  if (this.examType === 'TYT') {
    this.examScore = parseFloat((100 + totalNet * 3.3).toFixed(2));
  } else if (this.examType === 'AYT') {
    this.examScore = parseFloat((100 + totalNet * 3).toFixed(2));
  }

  next();
});

const TestTrack = mongoose.model('TestTrack', testTrackSchema);
export default TestTrack; </code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#PORT">PORT</a></li><li><a href="global.html#app">app</a></li><li><a href="global.html#calculateFinalScore">calculateFinalScore</a></li><li><a href="global.html#calculateStudyStreak">calculateStudyStreak</a></li><li><a href="global.html#calculateWeeklyProgress">calculateWeeklyProgress</a></li><li><a href="global.html#checkUserExists">checkUserExists</a></li><li><a href="global.html#createRoot">createRoot</a></li><li><a href="global.html#generateToken">generateToken</a></li><li><a href="global.html#getAYTSubjects">getAYTSubjects</a></li><li><a href="global.html#getQuizById">getQuizById</a></li><li><a href="global.html#getQuizzes">getQuizzes</a></li><li><a href="global.html#getSubjectById">getSubjectById</a></li><li><a href="global.html#getSubjectNames">getSubjectNames</a></li><li><a href="global.html#getSubjects">getSubjects</a></li><li><a href="global.html#getTYTSubjects">getTYTSubjects</a></li><li><a href="global.html#loginUser">loginUser</a></li><li><a href="global.html#matchPassword-Girilen%25C5%259Fifreyikontroleder">matchPassword - Girilen şifreyi kontrol eder</a></li><li><a href="global.html#protect">protect</a></li><li><a href="global.html#questionSchema">questionSchema</a></li><li><a href="global.html#quizAttemptSchema">quizAttemptSchema</a></li><li><a href="global.html#quizSchema">quizSchema</a></li><li><a href="global.html#registerUser">registerUser</a></li><li><a href="global.html#rootElement">rootElement</a></li><li><a href="global.html#subjectSchema">subjectSchema</a></li><li><a href="global.html#testResultSchema">testResultSchema</a></li><li><a href="global.html#testTrackSchema">testTrackSchema</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.4</a> on Fri Nov 29 2024 01:42:06 GMT+0300 (GMT+03:00)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
